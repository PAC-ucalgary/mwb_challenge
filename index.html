<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex, nofollow" />
  <title>MWB Volunteer Challenge – Live Leaderboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --brand:#b34445;
      --brand-light:#f5eaea;
      --text:#2c2b2b;
      --muted:#666;
      --bg:#fdfcfb;
      --card:#ffffff;
      --shadow:0 2px 10px rgba(0,0,0,.08);
      --gold:#d4af37;
      --silver:#c0c0c0;
      --bronze:#cd7f32;
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:'Outfit', sans-serif;
      background:var(--bg);
      color:var(--text);
    }

    /* HEADER BAR */
    header{
      background:var(--brand);
      color:white;
      text-align:center;
      padding:32px 16px 24px;
      box-shadow:0 2px 6px rgba(0,0,0,.2);
    }
    header img{
      height:70px;
      border-radius:10px;
      box-shadow:0 4px 12px rgba(0,0,0,.25);
    }
    header h1{
      margin:12px 0 4px;
      font-weight:800;
      font-size:28px;
    }
    header p{
      margin:0;
      font-weight:500;
      opacity:.9;
    }
    .actions{
      margin-top:14px;
      display:flex;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .btn{
      border:none;
      border-radius:8px;
      font-weight:600;
      cursor:pointer;
      padding:10px 16px;
    }
    .btn.primary{
      background:#fff;
      color:var(--brand);
    }
    .btn.secondary{
      background:rgba(255,255,255,.15);
      color:white;
      border:1px solid rgba(255,255,255,.3);
    }

    /* CONTENT WRAPPER */
    main{
      max-width:1100px;
      margin:0 auto;
      padding:32px 20px 60px;
    }

    /* CARDS */
    .card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:20px;
      margin-bottom:20px;
    }
    .card h3{
      margin-top:0;
      font-size:20px;
      border-left:6px solid var(--brand);
      padding-left:10px;
    }
    .note{color:var(--muted); margin-top:8px;}
    .warn{color:#b11;}

    /* GRID */
    .grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:20px;
    }
    @media(max-width:900px){.grid{grid-template-columns:1fr;}}

    /* TABLE */
    table{width:100%; border-collapse:collapse; margin-top:8px;}
    thead th{
      text-align:left;
      font-size:13px;
      text-transform:uppercase;
      letter-spacing:.3px;
      color:var(--muted);
      border-bottom:2px solid #eee;
      padding-bottom:6px;
    }
    td{
      padding:8px 4px;
      border-bottom:1px solid #f0f0f0;
    }

    /* Rank badges */
    .rank-badge{
      display:inline-block;
      min-width:28px;
      text-align:center;
      font-weight:700;
      color:#fff;
      border-radius:6px;
      padding:4px 6px;
    }
    .rank-1{background:var(--gold); color:#444;}
    .rank-2{background:var(--silver); color:#333;}
    .rank-3{background:var(--bronze);}
    .rank-badge:not(.rank-1):not(.rank-2):not(.rank-3){background:#ccc; color:#333;}

    /* Progress bar */
    .progress{height:6px; background:#f1f1f1; border-radius:4px; overflow:hidden;}
    .progress span{display:block; height:100%; background:var(--brand);}

    /* Podium */
    .podium{display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px;}
    .p{
      flex:1 1 160px;
      background:#f9f9f9;
      border-radius:10px;
      text-align:center;
      padding:12px;
      box-shadow:0 2px 6px rgba(0,0,0,.05);
    }
    .medal{
      font-weight:700;
      border-radius:999px;
      padding:6px 12px;
      display:inline-block;
    }
    .medal.g{background:var(--gold); color:#333;}
    .medal.s{background:var(--silver); color:#333;}
    .medal.b{background:var(--bronze); color:#fff;}
    footer{text-align:center; color:var(--muted); margin-top:30px; font-size:14px;}
  </style>
</head>
<body>

<header>
  <img src="assets/mwb-logo.png" alt="MWB Logo">
  <h1>MWB Volunteer Challenge</h1>
  <p>Track your team's progress • Updated live every minute</p>
  <div class="actions">
    <button class="btn secondary" onclick="location='#info'">Challenge Info</button>
    <button class="btn primary" onclick="location='#yearly'">Full Leaderboard</button>
  </div>
</header>

<main>
  <section id="info" class="card">
    <h3>How It Works</h3>
    <p>Form a team of 3–5 members and earn points by volunteering at MWB events like bake sales, bazaars, and annual dinners.
    Each member’s points contribute to the team total, averaged for fairness. Monthly winners earn prizes, scores reset each month,
    and cumulative points determine grand prize winners. Each member must contribute at least 10% of their team’s total points to qualify.</p>
  </section>

  <div class="grid">
    <section id="monthlyTeams" class="card">
      <h3>Monthly Team Leaderboard <small id="monthLabel"></small></h3>
      <div id="monthlyTeamsError" class="warn hidden">Could not load team data.</div>
      <table>
        <thead>
          <tr><th>Rank</th><th>Team</th><th>Members</th><th>Average Points</th></tr>
        </thead>
        <tbody id="monthlyTeamsBody"></tbody>
      </table>
      <p class="note">Team average = total points ÷ number of members</p>
    </section>

    <section id="topVolunteers" class="card">
      <h3>Top Volunteers <small id="monthLabel2"></small></h3>
      <div id="topVolsError" class="warn hidden">Could not load volunteer data.</div>
      <div class="podium" id="podium"></div>
      <table>
        <thead><tr><th>Rank</th><th>Name</th><th>Team</th><th>Points</th></tr></thead>
        <tbody id="topVolunteersBody"></tbody>
      </table>
    </section>
  </div>

  <section id="yearly" class="card">
    <h3>Yearly Overall Standings</h3>
    <div id="yearlyError" class="warn hidden">Could not load yearly standings.</div>
    <table>
      <thead><tr><th>Rank</th><th>Team</th><th>Total Points (Year)</th></tr></thead>
      <tbody id="yearlyBody"></tbody>
    </table>
    <p class="note">Each member must contribute ≥10% of team total to qualify for prizes.</p>
  </section>

  <footer>© MWB • Live data from Google Sheets • Auto-refreshes every 60 seconds</footer>
</main>

<script>
const INDIVIDUAL_CSV_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vQB94ZwTlKNFsY10SeVArbMcwC5BM3qkP1I2_er_WL6V657H1Aje4ZoidJSbAXRc21Zoxie2vdeGyek/pub?gid=759346056&single=true&output=csv";
const TEAM_CSV_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vQB94ZwTlKNFsY10SeVArbMcwC5BM3qkP1I2_er_WL6V657H1Aje4ZoidJSbAXRc21Zoxie2vdeGyek/pub?gid=0&single=true&output=csv";
const YEARLY_CSV_URL=""; const FIXED_MONTH="";

const $=s=>document.querySelector(s);
function thisMonthKey(){if(FIXED_MONTH)return FIXED_MONTH;let d=new Date();return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,'0');}
function monthLabel(k){let [y,m]=k.split('-').map(Number);return new Intl.DateTimeFormat(undefined,{month:'long',year:'numeric'}).format(new Date(y,m-1,1));}
function parseCSV(t){let r=[],i=0,f='',row=[],q=!1;while(i<t.length){let c=t[i];if(c=='"'){if(q&&t[i+1]=='"'){f+='"';i++;}else q=!q;}else if(c==','&&!q){row.push(f);f='';}else if((c=='\n'||c=='\r')&&!q){if(f!=''||row.length){row.push(f);r.push(row);row=[];f='';}}else f+=c;i++;}if(f!=''||row.length){row.push(f);r.push(row);}return r.filter(x=>x.length&&x.join('').trim()!='');}
async function fetchCSV(u){const res=await fetch(u,{cache:'no-store'});if(!res.ok)throw new Error("HTTP "+res.status);const text=await res.text();const rows=parseCSV(text);const headers=rows[0].map(h=>h.trim().toLowerCase());return rows.slice(1).map(r=>{let o={};headers.forEach((h,i)=>o[h]=(r[i]||'').trim());return o;});}
function number(n){const x=parseFloat(String(n).replace(/[^0-9.\-]/g,''));return isNaN(x)?0:x;}
function renderRows(tb,rows,fn){tb.innerHTML='';rows.forEach((o,i)=>{const tr=document.createElement('tr');tr.innerHTML=fn(o,i);tb.appendChild(tr);});}
function rankBadge(i){const r=i+1;let c='rank-badge';if(r==1)c+=' rank-1';else if(r==2)c+=' rank-2';else if(r==3)c+=' rank-3';return `<span class="${c}">${r}</span>`;}

async function loadData(){
 const m=thisMonthKey();$('#monthLabel').textContent='• '+monthLabel(m);$('#monthLabel2').textContent='• '+monthLabel(m);
 try{
  const [indiv,teams]=await Promise.all([fetchCSV(INDIVIDUAL_CSV_URL),fetchCSV(TEAM_CSV_URL)]);
  const teamMembers=teams.reduce((a,r)=>{const n=(r.team||'').trim();a[n]=number(r.members)||0;return a;},{});
  const monthData=indiv;
  const teamTotals={};monthData.forEach(v=>{const t=(v.team||'—').trim();teamTotals[t]=(teamTotals[t]||0)+number(v.points||v.score||v.pts);});
  const monthly=Object.entries(teamTotals).map(([team,total])=>{const m=teamMembers[team]||0;const avg=m?total/m:0;return{team,members:m,avg};}).sort((a,b)=>b.avg-a.avg);
  const max=monthly.length?monthly[0].avg:0;
  renderRows($('#monthlyTeamsBody'),monthly,(r,i)=>{const pct=max?Math.min(100,(r.avg/max)*100):0;return`<td>${rankBadge(i)}</td><td>${r.team}</td><td>${r.members}</td><td><strong>${r.avg.toFixed(2)}</strong><div class="progress"><span style="width:${pct}%"></span></div></td>`;});
  $('#monthlyTeamsError').classList.add('hidden');
  const volunteers=monthData.map(v=>({name:(v.name||'—').trim(),team:(v.team||'—').trim(),points:number(v.points||v.score||v.pts)})).sort((a,b)=>b.points-a.points).slice(0,20);
  const podium=volunteers.slice(0,3);const medal=i=>i==0?'g':i==1?'s':'b';
  $('#podium').innerHTML=podium.map((v,i)=>`<div class="p"><div class="medal ${medal(i)}">${i+1}</div><div style="margin-top:6px;font-weight:700">${v.name}</div><div style="opacity:.8">${v.team}</div><div style="margin-top:4px;font-size:14px"><strong>${v.points}</strong> pts</div></div>`).join('');
  renderRows($('#topVolunteersBody'),volunteers,(r,i)=>`<td>${rankBadge(i)}</td><td>${r.name}</td><td>${r.team}</td><td><strong>${r.points}</strong></td>`);
  $('#topVolsError').classList.add('hidden');
  let yearlySrc=indiv;try{if(YEARLY_CSV_URL)yearlySrc=await fetchCSV(YEARLY_CSV_URL);}catch(e){}
  const yearlyTotals=yearlySrc.reduce((a,v)=>{const t=(v.team||'—').trim();a[t]=(a[t]||0)+number(v.points||v.score||v.pts);return a;},{});
  const yearly=Object.entries(yearlyTotals).map(([team,total])=>({team,total})).sort((a,b)=>b.total-a.total);
  renderRows($('#yearlyBody'),yearly,(r,i)=>`<td>${rankBadge(i)}</td><td>${r.team}</td><td><strong>${r.total}</strong></td>`);
  $('#yearlyError').classList.add('hidden');
 }catch(e){console.error(e);$('#monthlyTeamsError').classList.remove('hidden');$('#topVolsError').classList.remove('hidden');$('#yearlyError').classList.remove('hidden');}
}
loadData();setInterval(loadData,60000);
</script>
</body>
</html>
